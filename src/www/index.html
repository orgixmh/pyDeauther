<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<link
			rel="stylesheet"
			type="text/css"
			href="style/animations.css"
		/>
		<link rel="stylesheet" type="text/css" href="style/style.css" />
		<link
			rel="stylesheet"
			type="text/css"
			href="style/fonts/gFonts.css"
		/>
		<link
			rel="stylesheet"
			type="text/css"
			href="style/switch.css"
		/>
		<link rel="icon" type="image/png" href="favicon.png" />
		<title>pyDeauther v0.0.1</title>
		<script src="./components/dial.js"></script>
		<script src="./util/rot.js"></script>
		<script type="importmap">
			{
				"imports": {
					"sound": "./sound/index.js",
					"util/": "./util/"
				}
			}
		</script>
		<script src="qrc:///qtwebchannel/qwebchannel.js"></script>
		<svg style="display: none;">
			<style>
				.handle {
					cursor: grab;
				}
			</style>
			<!-- SVG for the radial dial component -->
			<defs id="sample_gfx">
				<symbol
					id="circle-with-dot"
					viewBox="-6 -6 12 12"
				>
					<circle
						cx="0"
						cy="0"
						r="5.875"
						stroke="#2e3436"
						fill="#babdb6"
						stroke-width="0.25"
					/>
					<circle
						class="handle"
						cx="0"
						cy="-3.75"
						r="0.75"
						stroke="none"
						fill="#2e3436"
					/>
				</symbol>
			</defs>
		</svg>
	</head>

	<body class="theme-green">
		<div id="monitor" class="off">
			<div id="screen">
				<div id="crt">
					<div class="scanline"></div>
					<div class="terminal"></div>
				</div>
			</div>

			<div id="slider">
				<label class="switch">
					<input type="checkbox" />
					<span class="slider"></span>
				</label>
			</div>

			<div id="controls">
				<div id="sticky" class="post-it">
					Admin<br />only
				</div>

				<div id="themes">
					<button
						id="theme-red"
						class="theme"
					></button>
					<button
						id="theme-green"
						class="theme active"
					></button>
					<button
						id="theme-blue"
						class="theme"
					></button>
				</div>

				<div id="volume">
					<span>min</span>

					<div id="dial-container">
						<x-dial
							id="dial"
							min="0"
							max="0.75"
							value="0"
							svgsymbolid="circle-with-dot"
						>
						</x-dial>
					</div>
					<span>max</span>
				</div>

				<div id="power">
					<button id="fullscreen">
						â›¶
					</button>
					<label class="rocker rocker-small">
						<input
							id="switch"
							type="checkbox"
							checked
						/>
						<span class="switch-left"
							>O</span
						>
						<span class="switch-right"
							>I</span
						>
					</label>
				</div>
			</div>
		</div>

		
		<script type="module">
		  import { typeOut } from './util/screens.js';
		  import { on, off } from './util/power.js';
		  globalThis.typeOut = typeOut;
		  globalThis.on = on;
		  globalThis.off = off;
		</script>

		<script>
		   document.scannerState = true;
		   document.attackState = true;
		   document.modeState = true;
		   

		   function togglePower() {
				let isOff = document.getElementById("monitor").classList.contains("off");
			if (isOff) {
				on();
			} else {
				off();
			}
		  }
		  // Run only after DOM is ready
		  window.addEventListener('DOMContentLoaded', () => {
		    new QWebChannel(qt.webChannelTransport, function(channel) {
		      window.bridge = channel.objects.bridge;
		    });
		  });
	
		  function receiveData(obj) {

		    console.log("Received from backend: ", obj);
		    var command = String(obj.command);
		    var data = String(obj.data);
		    
		    if ( command == "typeOut"){
   				typeOut(data);
   			}else if ( command == "pyConfig" ){
   				console.log("Python Config received!")
   				document.pyConfig = obj.data;
   				if (document.pyConfig.automatic_turn_on){
					togglePower();
				}
				if (document.pyConfig.default_screen == "Matrix"){
					document.getElementById("theme-green").click()
				}else if(document.pyConfig.default_screen == "Red Queen"){
					document.getElementById("theme-red").click()
				}else {
					document.getElementById("theme-blue").click()
				}
   			}else if ( command == "scannerState" ){
			   document.scannerState = data == "true" ? true : false;
   			}
   			else if ( command == "attackState" ){
			   document.attackState = data == "true" ? true : false;
   			}else if ( command =="modeState" ) {
   				document.modeState = data == "true" ? true : false;
   			}
   			

		    return { ok: true };

		  }

		</script>
		<script src="./terminal.mjs" type="module"></script>


	</body>
</html>
